/* MyPhoner for TAB(FS) SDK version 0.1 */(function(){'use strict';(function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define([],b):a.MyPhoner=b()})(window,function(){function a(){this.elements=[]}var b,c="{BASEURI}",d="{WSURI}",e=parseInt("{ACWTIME}"),f=parseInt("{AUTOREADYTIME}"),g=!1,h="",i=null,j=null,k=null,l=0,m=null,n=0,o=null,p=new a;a.prototype.length=function(){return this.elements.length},a.prototype.peek=function(a){return("undefined"==typeof a||null==a)&&(a=0),0<=a&&a<this.elements.length?this.elements[a]:{uuid:void 0,calling:void 0,recordid:void 0,userdata:void 0,parentuuid:void 0,skill:void 0}},a.prototype.has=function(a){for(var b of this.elements)if(b.uuid==a)return b;return null},a.prototype.replace=function(a,b){for(var c=null,d=0;d<this.elements.length;d++)if(this.elements[d].uuid==a){c=this.elements.splice(d,1)[0];break}c&&(c.uuid=b,this.elements.unshift(c))},a.prototype.setCalling=function(a,b,c,d){for(var e=null,f=0;f<this.elements.length;f++)if(this.elements[f].uuid==a){e=this.elements.splice(f,1)[0];break}e?(b&&0<b.length&&(e.calling=b),"undefined"!=typeof c&&(e.inbound=c),d&&0<d.length&&(e.parentuuid=d)):e={uuid:a,calling:b,inbound:c,parentuuid:d},this.elements.unshift(e)},a.prototype.setUserData=function(a,b,c){for(var d=null,e=0;e<this.elements.length;e++)if(this.elements[e].uuid==a){d=this.elements.splice(e,1)[0];break}d?(b&&0<b.length&&(d.userdata=b),c&&0<c.length&&(d.skill=c)):d={uuid:a,userdata:b,skill:c},this.elements.unshift(d)},a.prototype.setRecordId=function(a,b){for(var c=null,d=0;d<this.elements.length;d++)if(this.elements[d].uuid==a){c=this.elements.splice(d,1)[0];break}c?b&&0<b.length&&(c.recordid=b):c={uuid:a,recordid:b},this.elements.unshift(c)},a.prototype.delete=function(a){for(var b=0;b<this.elements.length;b++)if(this.elements[b].uuid==a)return this.elements.splice(b,1),!0;return!1},a.prototype.clear=function(){this.elements=[]},a.prototype.debug=function(a){if(0<this.elements.length)for(var b=0;b<this.elements.length;b++)console.debug(a+b+"="+JSON.stringify(this.elements[b]));else console.debug(a+"0=NULL")};var q=function(a){i&&(i.send("Method="+a),!g&&("Logout"==a&&t("Logout"),i.close(),i=null))},r=function(a){j&&(clearTimeout(j),j=null),i&&(i.close(),i=null),"function"==typeof a&&(k=a),i=new window.WebSocket((0<d.length?d:c)+"/tab/phone/?Library=Login&Agent="+b+"&Extension="+h),i.onmessage=function(a){t(a.data),"Logout"===a.data&&(g=!1,i.close(),i=null)},i.onclose=function(){g&&(j=setTimeout(function(){console.debug("WebSocket Reconnection...."),r()},2e3))},i.onopen=function(){null!=j&&(clearTimeout(j),j=null)}},s=async function(a,b){var c="undefined"==typeof b?h:b;h=c,window.WebSocket?"function"==typeof a?(g=!0,r(a),console.debug("Success.")):console.error("Need a function as a parameter!"):console.error("WebSocket not supported by this browser!")},t=function(a){try{var b=JSON.parse(a);switch(b.method){case"Ring":p.setCalling(b.uuid,b.caller,!0),p.setUserData(b.uuid,b.userdata),"function"==typeof k&&k("Ring "+b.caller);break;case"Dial":p.setCalling(b.uuid,b.called,!1),p.setUserData(b.uuid,b.userdata),"function"==typeof k&&k("Dial "+b.called);}}catch(g){if(0==a.indexOf("Disconnect")){if(f>e){n=0;var c=e/2;1>c&&(c=1),o=setTimeout(u,1e3*c)}var d=a.substring(11);p.has(d)&&(p.delete(d),0==p.length()&&"function"==typeof k&&k(a))}else if(0==a.indexOf("Connected")){var d=a.substring(10);null!=d&&0<d.length&&!p.has(d)&&p.setCalling(d),"function"==typeof k&&k(a)}else if(0==a.indexOf("Answer")){var d=a.substring(7);null!=d&&0<d.length&&!p.has(d)&&p.setCalling(d),"function"==typeof k&&k(a)}else if(0==a.indexOf("Ready"))null!=o&&(clearTimeout(o),o=null),l=-1,-1!=m&&(m=-1,"function"==typeof k&&k("Ready"));else if(0==a.indexOf("NotReady")||0==a.indexOf("Notready"))null!=o&&(clearTimeout(o),o=null),l=0,0!=m&&(m=0,"function"==typeof k&&k("NotReady"));else if(0==a.indexOf("Login"))l=0,m=null,"function"==typeof k&&k("Login");else if(0==a.indexOf("Logout"))"function"==typeof k&&k("Logout");else if(0==a.indexOf("Hold"))"function"==typeof k&&k("Hold");else if(0==a.indexOf("Unhold"))"function"==typeof k&&k("Unhold");else try{var b=JSON.parse(a)}catch(b){console.info(a)}}},u=function(){var a=e/2;1>a&&(a=1),n+=a,n<f?(0<e&&MyPhoner.NotReady(1),o=setTimeout(u,1e3*a)):("function"==typeof k&&k("AutoReady"),o=null,MyPhoner.Ready())},v=function(){return i&&i.send("GetCallInfo"),p.peek()},w=function(){return i?(q("GetLoginInfo"),{agent:b,extension:h,uuid:"",userdata:""}):null},x=function(){return l};return{Login:function(a,g,i,j,k,l){"undefined"!=typeof MyPhonerHost&&(0==MyPhonerHost.baseUri.length&&(MyPhonerHost.baseUri=location.origin),c=MyPhonerHost.baseUri,0==MyPhonerHost.wsUri.length&&(MyPhonerHost.wsUri=(0==window.location.protocol.indexOf("https")?"wss://":"ws://")+window.location.hostname),d=MyPhonerHost.wsUri,f=MyPhonerHost.autoReadyTime,e=MyPhonerHost.acwTime),b=a,h=i,s(l)},Ready:function(a){"undefined"!=typeof a&&null!==a?q("Ready&Status="+a):q("Ready")},NotReady:function(a){"undefined"!=typeof a&&null!==a?q("Notready&Status="+a):q("Notready")},Dial:function(a,b){"undefined"!=typeof b&&null!==b?q("Dial&Phone="+a+"&Data="+b):q("Dial&Phone="+a)},MakeCall:function(a,b){/^\d+$/.test(a)&&19>a.length&&("undefined"!=typeof b&&null!==b?q("MakeCall&Phone="+a+"&Data="+b):q("MakeCall&Phone="+a))},GetCallInfo:v,Hangup:function(){q("Hangup&uuid="+p.peek().uuid)},Answer:function(){q("Answer&uuid="+p.peek().uuid)},Reject:function(a){q("Reject&Phone="+a)},Logout:function(){g=!1,q("Logout")},Hold:function(){q("Hold&uuid="+p.peek().uuid)},Unhold:function(){q("Unhold&uuid="+p.peek().uuid)},Conference:function(a,b){/^\d+$/.test(a)&&19>a.length&&("undefined"!=typeof b&&null!==b?q("Conference&Phone="+a+"&Data="+b):q("Conference&Phone="+a))},Transfer:function(a,b){/^\d+$/.test(a)&&19>a.length&&("undefined"!=typeof b&&null!==b?q("Transfer&Phone="+a+"&Data="+b):q("Transfer&Phone="+a))},ConferenceCall:function(){q("ConferenceCall")},TransferCall:function(){q("TransferCall")},GetConsulCall:function(){return!1},GetEvents:s,GetLoginInfo:w,GetReadyStatus:x,Monitor:function(a){q("Monitor&Phone="+a)},Intrude:function(a){q("Intrude&Phone="+a)},GetUsers:function(){}}})})();
//# sourceMappingURL=MyPhoner.js.map
