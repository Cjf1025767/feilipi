{"version":3,"file":"monitor.js","sources":["../src/jquery.jsonrpcclient.js","../src/monitor.js"],"sourcesContent":["/**\r\n * JsonRpcClient\r\n *\r\n * A JSON RPC Client that uses WebSockets if available otherwise fallbacks to ajax.\r\n * Depends on JSON, if browser lacks native support either use JSON3 or jquery.json.\r\n * Usage example:\r\n *\r\n *   var foo = new $.JsonRpcClient({ ajaxUrl: '/backend/jsonrpc' });\r\n *   foo.call(\r\n *     'bar', [ 'A parameter', 'B parameter' ],\r\n *     function(result) { alert('Foo bar answered: ' + result.my_answer); },\r\n *     function(error)  { console.log('There was an error', error); }\r\n *   );\r\n *\r\n * More examples are available in README.md\r\n */\r\n(function (factory) {\r\n\tif (typeof define === 'function' && define.amd) {\r\n\t\t// AMD\r\n\t\tdefine(['jquery'], factory);\r\n\t} else if (typeof exports === 'object') {\r\n\t\t// CommonJS\r\n\t\tfactory(require('jquery'));\r\n\t} else {\r\n\t\t// Browser globals\r\n\t\tfactory(jQuery);\r\n\t}\r\n}\r\n(function($){\r\n\r\n  /**\r\n   * @fn new\r\n   * @memberof JsonRpcClient\r\n   *\r\n   * @param {object} options An object stating the backends:\r\n   *                ajaxUrl    A url (relative or absolute) to a http(s) backend.\r\n   *                headers    An object that will be passed along to $.ajax in options.headers\r\n   *                xhrFields  An object that will be passed along to $.ajax in options.xhrFields\r\n   *                socketUrl  A url (relative of absolute) to a ws(s) backend.\r\n   *                onmessage  A socket message handler for other messages (non-responses).\r\n   *                onopen     A socket onopen handler. (Not used for custom getSocket.)\r\n   *                onclose    A socket onclose handler. (Not used for custom getSocket.)\r\n   *                onerror    A socket onerror handler. (Not used for custom getSocket.)\r\n   *                getSocket  A function returning a WebSocket or null.\r\n   *                           It must take an onmessage_cb and bind it to the onmessage event\r\n   *                           (or chain it before/after some other onmessage handler).\r\n   *                           Or, it could return null if no socket is available.\r\n   *                           The returned instance must have readyState <= 1, and if less than 1,\r\n   *                           react to onopen binding.\r\n   *                timeout    (optional) A number of ms to wait before timing out and failing a\r\n   *                           call. If specified a setTimeout will be used to keep track of calls\r\n   *                           made through a websocket.\r\n   */\r\n  var JsonRpcClient = function(options) {\r\n    var self = this;\r\n    var noop = function() {};\r\n    this.options = $.extend({\r\n      ajaxUrl     : null,\r\n      headers     : {},   ///< Optional additional headers to send in $.ajax request.\r\n      socketUrl   : null, ///< WebSocket URL. (Not used if a custom getSocket is supplied.)\r\n      onmessage   : noop, ///< Optional onmessage-handler for WebSocket.\r\n      onopen      : noop, ///< Optional onopen-handler for WebSocket.\r\n      onclose     : noop, ///< Optional onclose-handler for WebSocket.\r\n      onerror     : noop, ///< Optional onerror-handler for WebSocket.\r\n      /// Custom socket supplier for using an already existing socket\r\n      getSocket   : function(onmessageCb) { return self._getSocket(onmessageCb); }\r\n    }, options);\r\n\r\n    // Declare an instance version of the onmessage callback to wrap 'this'.\r\n    this.wsOnMessage = function(event) { self._wsOnMessage(event); };\r\n\r\n    /// Holding the WebSocket on default getsocket.\r\n    this._wsSocket = null;\r\n\r\n    /// Object <id>: { success_cb: cb, error_cb: cb }\r\n    this._wsCallbacks = {};\r\n\r\n    /// The next JSON-RPC request id.\r\n    this._currentId = 1;\r\n\r\n    //queue for ws request sent *before* ws is open.\r\n    this._wsRequestQueue = [];\r\n\r\n    if (!window.JSON && $ && $.toJSON) {\r\n      this.JSON = {\r\n        stringify: $.toJSON,\r\n        parse: $.parseJSON\r\n      };\r\n    } else {\r\n      this.JSON = JSON;\r\n    }\r\n\r\n  };\r\n\r\n  /**\r\n   * @fn call\r\n   * @memberof JsonRpcClient\r\n   *\r\n   * @param {string}       method     The method to run on JSON-RPC server.\r\n   * @param {object|array} params     The params; an array or object.\r\n   * @param {function}     successCb  A callback for successful request.\r\n   * @param {function}     errorCb    A callback for error.\r\n   *\r\n   * @return {object} Returns the deferred object that $.ajax returns or {null} for websockets\r\n   */\r\n  JsonRpcClient.prototype.call = function(method, params, successCb, errorCb) {\r\n    successCb = typeof successCb === 'function' ? successCb : function() {};\r\n    errorCb   = typeof errorCb   === 'function' ? errorCb   : function() {};\r\n\r\n    // Construct the JSON-RPC 2.0 request.\r\n    var request = {\r\n      jsonrpc : '2.0',\r\n      method  : method,\r\n      params  : params,\r\n      id      : this._currentId++  // Increase the id counter to match request/response\r\n    };\r\n\r\n    // Try making a WebSocket call.\r\n    var socket = this.options.getSocket(this.wsOnMessage);\r\n    if (socket !== null) {\r\n      this._wsCall(socket, request, successCb, errorCb);\r\n      return null;\r\n    }\r\n\r\n    // No WebSocket, and no HTTP backend?  This won't work.\r\n    if (this.options.ajaxUrl === null) {\r\n      throw 'JsonRpcClient.call used with no websocket and no http endpoint.';\r\n    }\r\n\r\n    var self = this;\r\n\r\n    var deferred = $.ajax({\r\n      type       : 'POST',\r\n      url        : this.options.ajaxUrl,\r\n      contentType: 'application/json',\r\n      data       : this.JSON.stringify(request),\r\n      dataType   : 'json',\r\n      cache      : false,\r\n      headers    : this.options.headers,\r\n      xhrFields  : this.options.xhrFields,\r\n      timeout    : this.options.timeout,\r\n\r\n      success    : function(data) {\r\n        if ('error' in data) {\r\n          errorCb(data.error);\r\n        } else {\r\n          successCb(data.result);\r\n        }\r\n      },\r\n\r\n      // JSON-RPC Server could return non-200 on error\r\n      error    : function(jqXHR, textStatus, errorThrown) {\r\n        try {\r\n          var response = self.JSON.parse(jqXHR.responseText);\r\n          if ('console' in window) { console.log(response); }\r\n\r\n          errorCb(response.error);\r\n        }\r\n        catch (err) {\r\n          // Perhaps the responseText wasn't really a jsonrpc-error.\r\n          errorCb({error: jqXHR.responseText});\r\n        }\r\n      }\r\n    });\r\n\r\n    return deferred;\r\n  };\r\n\r\n  /**\r\n   * Notify sends a command to the server that won't need a response.  In http, there is probably\r\n   * an empty response - that will be dropped, but in ws there should be no response at all.\r\n   *\r\n   * This is very similar to call, but has no id and no handling of callbacks.\r\n   *\r\n   * @fn notify\r\n   * @memberof JsonRpcClient\r\n   *\r\n   * @param {string} method       The method to run on JSON-RPC server.\r\n   * @param {object|array} params The params; an array or object.\r\n   *\r\n   * @return {object} Returns the deferred object that $.ajax returns or {null} for websockets\r\n   */\r\n  JsonRpcClient.prototype.notify = function(method, params) {\r\n    // Construct the JSON-RPC 2.0 request.\r\n    var request = {\r\n      jsonrpc: '2.0',\r\n      method:  method,\r\n      params:  params\r\n    };\r\n\r\n    // Try making a WebSocket call.\r\n    var socket = this.options.getSocket(this.wsOnMessage);\r\n    if (socket !== null) {\r\n      this._wsCall(socket, request);\r\n      return null;\r\n    }\r\n\r\n    // No WebSocket, and no HTTP backend?  This won't work.\r\n    if (this.options.ajaxUrl === null) {\r\n      throw 'JsonRpcClient.notify used with no websocket and no http endpoint.';\r\n    }\r\n\r\n    var deferred = $.ajax({\r\n      type       : 'POST',\r\n      url        : this.options.ajaxUrl,\r\n      contentType: 'application/json',\r\n      data       : this.JSON.stringify(request),\r\n      dataType   : 'json',\r\n      cache      : false,\r\n      headers    : this.options.headers,\r\n      xhrFields  : this.options.xhrFields\r\n    });\r\n\r\n    return deferred;\r\n  };\r\n\r\n  /**\r\n   * Make a batch-call by using a callback.\r\n   *\r\n   * The callback will get an object \"batch\" as only argument.  On batch, you can call the methods\r\n   * \"call\" and \"notify\" just as if it was a normal JsonRpcClient object, and all calls will be\r\n   * sent as a batch call then the callback is done.\r\n   *\r\n   * @fn batch\r\n   * @memberof JsonRpcClient\r\n   *\r\n   * @param {function} callback   This function will get a batch handler to run call and notify on.\r\n   * @param {function} allDoneCb  A callback function to call after all results have been handled.\r\n   * @param {function} errorCb    A callback function to call if there is an error from the server.\r\n   *                    Note, that batch calls should always get an overall success, and the\r\n   *                    only error\r\n   */\r\n  JsonRpcClient.prototype.batch = function(callback, allDoneCb, errorCb) {\r\n    var batch = new JsonRpcClient._batchObject(this, allDoneCb, errorCb);\r\n    callback(batch);\r\n    batch._execute();\r\n  };\r\n\r\n  /**\r\n   * The default getSocket handler.\r\n   *\r\n   * @param {function} onmessageCb The callback to be bound to onmessage events on the socket.\r\n   *\r\n   * @fn _getSocket\r\n   * @memberof JsonRpcClient\r\n   */\r\n  JsonRpcClient.prototype._getSocket = function(onmessageCb) {\r\n    // If there is no ws url set, we don't have a socket.\r\n    // Likewise, if there is no window.WebSocket.\r\n    if (this.options.socketUrl === null || !('WebSocket' in window)) { return null; }\r\n\r\n    if (this._wsSocket === null || this._wsSocket.readyState > 1) {\r\n\r\n      try {\r\n        // No socket, or dying socket, let's get a new one.\r\n        this._wsSocket = new WebSocket(this.options.socketUrl);\r\n      } catch (e) {\r\n        // This can happen if the server is down, or malconfigured.\r\n        return null;\r\n      }\r\n\r\n      // Set up onmessage handler.\r\n      this._wsSocket.onmessage = onmessageCb;\r\n\r\n      var that = this;\r\n      // Set up onclose handler.\r\n      this._wsSocket.onclose = function(ev) { that._wsOnClose(ev); };\r\n\r\n      // Set up onerror handler.\r\n      this._wsSocket.onerror = function(ev) { that._wsOnError(ev); };\r\n    }\r\n\r\n    return this._wsSocket;\r\n  };\r\n\r\n  /**\r\n   * Internal handler to dispatch a JRON-RPC request through a websocket.\r\n   *\r\n   * @fn _wsCall\r\n   * @memberof JsonRpcClient\r\n   */\r\n  JsonRpcClient.prototype._wsCall = function(socket, request, successCb, errorCb) {\r\n    var requestJson = this.JSON.stringify(request);\r\n\r\n    // Setup callbacks.  If there is an id, this is a call and not a notify.\r\n    if ('id' in request && typeof successCb !== 'undefined') {\r\n      this._wsCallbacks[request.id] = {successCb: successCb, errorCb: errorCb};\r\n    }\r\n\r\n    if (socket.readyState < 1) {\r\n\r\n      // Queue request\r\n      this._wsRequestQueue.push(requestJson);\r\n\r\n      if (!socket.onopen) {\r\n        // The websocket is not open yet; we have to set sending of the message in onopen.\r\n        var self = this; // In closure below, this is set to the WebSocket.  Use self instead.\r\n\r\n        // Set up sending of message for when the socket is open.\r\n        socket.onopen = function(event) {\r\n          // Hook for extra onopen callback\r\n          self.options.onopen(event);\r\n\r\n          // Send queued requests.\r\n          var timeout = self.options.timeout;\r\n          var request;\r\n          for (var i = 0; i < self._wsRequestQueue.length; i++) {\r\n            request = self._wsRequestQueue[i];\r\n\r\n            // Do we use timeouts, and if so, is it a call?\r\n            if (timeout && self._wsCallbacks[request.id]) {\r\n              self._wsCallbacks[request.id].timeout = self._createTimeout(request.id);\r\n            }\r\n            socket.send(request);\r\n          }\r\n          self._wsRequestQueue = [];\r\n        };\r\n      }\r\n    } else {\r\n\r\n      // Do we use timeouts, and if so, is it a call?\r\n      if (this.options.timeout && this._wsCallbacks[request.id]) {\r\n        this._wsCallbacks[request.id].timeout = this._createTimeout(request.id);\r\n      }\r\n\r\n      // We have a socket and it should be ready to send on.\r\n      socket.send(requestJson);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Internal handler for the websocket messages.  It determines if the message is a JSON-RPC\r\n   * response, and if so, tries to couple it with a given callback.  Otherwise, it falls back to\r\n   * given external onmessage-handler, if any.\r\n   *\r\n   * @param {event} event The websocket onmessage-event.\r\n   */\r\n  JsonRpcClient.prototype._wsOnMessage = function(event) {\r\n\r\n    // Check if this could be a JSON RPC message.\r\n    var response;\r\n    try {\r\n      response = this.JSON.parse(event.data);\r\n    } catch (err) {\r\n      this.options.onmessage(event);\r\n      return;\r\n    }\r\n\r\n    /// @todo Make using the jsonrcp 2.0 check optional, to use this on JSON-RPC 1 backends.\r\n    if (typeof response === 'object' && response.jsonrpc === '2.0') {\r\n\r\n      /// @todo Handle bad response (without id).\r\n\r\n      // If this is an object with result, it is a response.\r\n      if ('result' in response && this._wsCallbacks[response.id]) {\r\n        // Get the success callback.\r\n        var successCb = this._wsCallbacks[response.id].successCb;\r\n\r\n        // Clear any timeout\r\n        if (this._wsCallbacks[response.id].timeout) {\r\n          clearTimeout(this._wsCallbacks[response.id].timeout);\r\n        }\r\n\r\n        // Delete the callback from the storage.\r\n        delete this._wsCallbacks[response.id];\r\n\r\n        // Run callback with result as parameter.\r\n        successCb(response.result);\r\n        return;\r\n      }\r\n\r\n      // If this is an object with error, it is an error response.\r\n      else if ('error' in response && this._wsCallbacks[response.id]) {\r\n        // Get the error callback.\r\n        var errorCb = this._wsCallbacks[response.id].errorCb;\r\n\r\n        // Delete the callback from the storage.\r\n        delete this._wsCallbacks[response.id];\r\n\r\n        // Run callback with the error object as parameter.\r\n        errorCb(response.error);\r\n        return;\r\n      }\r\n    }\r\n\r\n    // If we get here it's an invalid JSON-RPC response, pass to fallback message handler.\r\n    this.options.onmessage(event);\r\n  };\r\n\r\n  /**\r\n   * Internal WebSocket error handler.\r\n   * Will execute all unresolved calls immideatly.\r\n   **/\r\n  JsonRpcClient.prototype._wsOnError = function(event) {\r\n    this._failAllCalls('Socket errored.');\r\n    this.options.onerror(event);\r\n  };\r\n\r\n  /**\r\n   * Internal WebSocket close handler.\r\n   * Will execute all unresolved calls immideatly.\r\n   **/\r\n  JsonRpcClient.prototype._wsOnClose = function(event) {\r\n    this._failAllCalls('Socket closed.');\r\n    this.options.onclose(event);\r\n  };\r\n\r\n  /**\r\n   * Execute error handler on all pending calls.\r\n   */\r\n  JsonRpcClient.prototype._failAllCalls = function(error) {\r\n    for (var key in this._wsCallbacks) {\r\n      if (this._wsCallbacks.hasOwnProperty(key)) {\r\n        // Get the error callback.\r\n        var errorCb = this._wsCallbacks[key].errorCb;\r\n\r\n        // Run callback with the error object as parameter.\r\n        errorCb(error);\r\n      }\r\n    }\r\n\r\n    // Throw 'em away\r\n    this._wsCallbacks = {};\r\n  };\r\n\r\n  /**\r\n   * Create a timeout for this request\r\n   */\r\n  JsonRpcClient.prototype._createTimeout = function(id) {\r\n    if (this.options.timeout) {\r\n      var that = this;\r\n      return setTimeout(function() {\r\n        if (that._wsCallbacks[id]) {\r\n          var errorCb = that._wsCallbacks[id].errorCb;\r\n          delete that._wsCallbacks[id];\r\n          errorCb('Call timed out.');\r\n        }\r\n      }, this.options.timeout);\r\n    }\r\n  };\r\n\r\n  /************************************************************************************************\r\n   * Batch object with methods\r\n   ************************************************************************************************/\r\n\r\n  /**\r\n   * Handling object for batch calls.\r\n   */\r\n  JsonRpcClient._batchObject = function(jsonrpcclient, allDoneCb, errorCb) {\r\n    // Array of objects to hold the call and notify requests.  Each objects will have the request\r\n    // object, and unless it is a notify, successCb and errorCb.\r\n    this._requests   = [];\r\n\r\n    this.jsonrpcclient = jsonrpcclient;\r\n    this.allDoneCb = allDoneCb;\r\n    this.errorCb    = typeof errorCb    === 'function' ? errorCb : function() {};\r\n  };\r\n\r\n  /**\r\n   * @sa JsonRpcClient.prototype.call\r\n   */\r\n  JsonRpcClient._batchObject.prototype.call = function(method, params, successCb, errorCb) {\r\n    this._requests.push({\r\n      request    : {\r\n        jsonrpc : '2.0',\r\n        method  : method,\r\n        params  : params,\r\n        id      : this.jsonrpcclient._currentId++  // Use the client's id series.\r\n      },\r\n      successCb : successCb,\r\n      errorCb   : errorCb\r\n    });\r\n  };\r\n\r\n  /**\r\n   * @sa JsonRpcClient.prototype.notify\r\n   */\r\n  JsonRpcClient._batchObject.prototype.notify = function(method, params) {\r\n    this._requests.push({\r\n      request    : {\r\n        jsonrpc : '2.0',\r\n        method  : method,\r\n        params  : params\r\n      }\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Executes the batched up calls.\r\n   *\r\n   * @return {object} Returns the deferred object that $.ajax returns or {null} for websockets\r\n   */\r\n  JsonRpcClient._batchObject.prototype._execute = function() {\r\n    var self = this;\r\n    var deferred = null; // Used to store and return the deffered that $.ajax returns\r\n\r\n    if (this._requests.length === 0) { return; } // All done :P\r\n\r\n    // Collect all request data and sort handlers by request id.\r\n    var batchRequest = [];\r\n\r\n    // If we have a WebSocket, just send the requests individually like normal calls.\r\n    var socket = self.jsonrpcclient.options.getSocket(self.jsonrpcclient.wsOnMessage);\r\n\r\n    if (socket !== null) {\r\n      // We need to keep track of results for the all done callback\r\n      var expectedNrOfCb = 0;\r\n      var cbResults = [];\r\n\r\n      var wrapCb = function(cb) {\r\n        if (!self.allDoneCb) { // No all done callback? no need to keep track\r\n          return cb;\r\n        }\r\n\r\n        return function(data) {\r\n          cb(data);\r\n          cbResults.push(data);\r\n          expectedNrOfCb--;\r\n          if (expectedNrOfCb <= 0) {\r\n            // Change order so that it maps to request order\r\n            var i;\r\n            var resultMap = {};\r\n            for (i = 0; i < cbResults.length; i++) {\r\n              resultMap[cbResults[i].id] = cbResults[i];\r\n            }\r\n            var results = [];\r\n            for (i = 0; i < self._requests.length; i++) {\r\n              if (resultMap[self._requests[i].id]) {\r\n                results.push(resultMap[self._requests[i].id]);\r\n              }\r\n            }\r\n            // Call all done!\r\n            self.allDoneCb(results);\r\n          }\r\n        };\r\n      };\r\n\r\n      for (var i = 0; i < this._requests.length; i++) {\r\n        var call = this._requests[i];\r\n\r\n        if ('id' in call.request) {\r\n          // We expect an answer\r\n          expectedNrOfCb++;\r\n        }\r\n\r\n        self.jsonrpcclient._wsCall(\r\n          socket, call.request, wrapCb(call.successCb), wrapCb(call.errorCb)\r\n        );\r\n      }\r\n\r\n      return null;\r\n    } else {\r\n      // No websocket, let's use ajax\r\n      var handlers = {};\r\n\r\n      for (var i = 0; i < this._requests.length; i++) {\r\n        var call = this._requests[i];\r\n        batchRequest.push(call.request);\r\n\r\n        // If the request has an id, it should handle returns (otherwise it's a notify).\r\n        if ('id' in call.request) {\r\n          handlers[call.request.id] = {\r\n            successCb : call.successCb,\r\n            errorCb   : call.errorCb\r\n          };\r\n        }\r\n      }\r\n\r\n      var successCb = function(data) { self._batchCb(data, handlers, self.allDoneCb); };\r\n\r\n      // No WebSocket, and no HTTP backend?  This won't work.\r\n      if (self.jsonrpcclient.options.ajaxUrl === null) {\r\n        throw 'JsonRpcClient.batch used with no websocket and no http endpoint.';\r\n      }\r\n\r\n      // Send request\r\n      deferred = $.ajax({\r\n        url        : self.jsonrpcclient.options.ajaxUrl,\r\n        contentType: 'application/json',\r\n        data       : this.jsonrpcclient.JSON.stringify(batchRequest),\r\n        dataType   : 'json',\r\n        cache      : false,\r\n        type       : 'POST',\r\n        headers    : self.jsonrpcclient.options.headers,\r\n        xhrFields  : self.jsonrpcclient.options.xhrFields,\r\n\r\n        // Batch-requests should always return 200\r\n        error    : function(jqXHR, textStatus, errorThrown) {\r\n          self.errorCb(jqXHR, textStatus, errorThrown);\r\n        },\r\n        success  : successCb\r\n      });\r\n\r\n      return deferred;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  /**\r\n   * Internal helper to match the result array from a batch call to their respective callbacks.\r\n   *\r\n   * @fn _batchCb\r\n   * @memberof JsonRpcClient\r\n   */\r\n  JsonRpcClient._batchObject.prototype._batchCb = function(result, handlers, allDoneCb) {\r\n    for (var i = 0; i < result.length; i++) {\r\n      var response = result[i];\r\n\r\n      // Handle error\r\n      if ('error' in response) {\r\n        if (response.id === null || !(response.id in handlers)) {\r\n          // An error on a notify?  Just log it to the console.\r\n          if ('console' in window) { console.log(response); }\r\n        } else {\r\n          handlers[response.id].errorCb(response.error);\r\n        }\r\n      } else {\r\n        // Here we should always have a correct id and no error.\r\n        if (!(response.id in handlers) && 'console' in window) {\r\n          console.log(response);\r\n        } else {\r\n          handlers[response.id].successCb(response.result);\r\n        }\r\n      }\r\n    }\r\n\r\n    if (typeof allDoneCb === 'function') { allDoneCb(result); }\r\n  };\r\n\r\n  $.JsonRpcClient = JsonRpcClient;\r\n\r\n//})(this.jQuery);\r\n}));","import \"./jquery.jsonrpcclient.js\";\r\n(function (factory) {\r\n\tif (typeof define === 'function' && define.amd) {\r\n\t\t// AMD\r\n\t\tdefine(['jquery'], factory);\r\n\t} else if (typeof exports === 'object') {\r\n\t\t// CommonJS\r\n\t\tfactory(require('jquery'));\r\n\t} else {\r\n\t\t// Browser globals\r\n\t\tfactory(jQuery);\r\n\t}\r\n}(function ($) {\r\n\t'use strict';\r\n\t$.Monitor = function () {\r\n\t\tvar webClient = null;\r\n\r\n\t\tfunction checkWebClient() {\r\n\t\t\tif (webClient == null) {\r\n\t\t\t\twebClient = new $.JsonRpcClient({\r\n\t\t\t\t\tsocketUrl: cmserver + \"/chat/?crmkey=\" + crmkey,\r\n\t\t\t\t\tonmessage: onAgentMessage,\r\n\t\t\t\t\tonclose: function () {\r\n\t\t\t\t\t\twebClient = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\treturn webClient;\r\n\t\t}\r\n\t\tfunction onAgentMessage(e) {\r\n\t\t\tcbMonitorCallBack(e.data);\r\n\t\t}\r\n\t\tfunction monitor(server,callback) {\r\n\t\t\tcmserver = server;\r\n\t\t\tif (typeof callback == 'function') {\r\n\t\t\t\tcbMonitorCallBack = callback;\r\n\t\t\t}else{\r\n\t\t\t\tcbMonitorCallBack = function () { };\r\n\t\t\t}\r\n\t\t\tif (checkWebClient() != null) {\r\n\t\t\t\twebClient.call(\"Monitor\", {});\r\n\t\t\t}\r\n\t\t};\r\n\t\tfunction listen(exten,agent) {\r\n\t\t\tif (checkWebClient() != null) {\r\n\t\t\t\twebClient.call(\"Listen\", {exten:exten,agent:agent});\r\n\t\t\t}\r\n\t\t};\r\n\t\tfunction getextensionstatus(exten,agent,callback) {\r\n\t\t\tvar opt = $.extend({\r\n\t\t\t\textension: exten,\r\n\t\t\t\tagent: agent\r\n\t\t\t},{});\r\n\t\t\tif (checkWebClient() != null) {\r\n\t\t\t\twebClient.call(\"GetextensionState\", opt, callback, function () {\r\n\t\t\t\t\twebClient = null;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar crmkey = \"jdflsdjfgsdjklajdfgoej\";\r\n\t\tvar cmserver = \"ws://127.0.0.1:55588\"; //如果不直连，而用nginx做路径/fs/的反向代理，注意超时proxy_read_timeout 600s;\r\n\t\tvar cbMonitorCallBack = function () { };\r\n\t\treturn {\r\n\t\t\tmonitor: monitor,\r\n\t\t\tlisten: listen,\r\n\t\t\tgetextensionstatus: getextensionstatus\r\n\t\t};\r\n\t}\r\n}));"],"names":["factory","define","amd","exports","require","jQuery","$","JsonRpcClient","options","self","noop","extend","ajaxUrl","headers","socketUrl","onmessage","onopen","onclose","onerror","getSocket","onmessageCb","_getSocket","wsOnMessage","event","_wsOnMessage","_wsSocket","_wsCallbacks","_currentId","_wsRequestQueue","JSON","window","toJSON","stringify","parse","parseJSON","prototype","call","method","params","successCb","errorCb","request","jsonrpc","id","socket","_wsCall","deferred","ajax","type","url","contentType","data","dataType","cache","xhrFields","timeout","success","error","result","jqXHR","response","responseText","console","log","err","notify","batch","callback","allDoneCb","_batchObject","_execute","readyState","WebSocket","e","that","ev","_wsOnClose","_wsOnError","requestJson","_createTimeout","send","push","i","length","_typeof","clearTimeout","_failAllCalls","key","hasOwnProperty","setTimeout","jsonrpcclient","_requests","batchRequest","expectedNrOfCb","cbResults","wrapCb","cb","resultMap","results","handlers","_batchCb","textStatus","errorThrown","Monitor","checkWebClient","webClient","cmserver","crmkey","onAgentMessage","cbMonitorCallBack","monitor","server","listen","exten","agent","getextensionstatus","opt","extension"],"mappings":"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"}